<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link href="https://fonts.googleapis.com/css?family=Permanent+Marker" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
        <!-- Bootstrap -->
        <link rel="stylesheet" href="css/bootstrap.css"/>

        <link rel="stylesheet" href="css/styles.css"/>

        <link href="https://fonts.googleapis.com/css?family=Creepster|VT323" rel="stylesheet"/>
        <title>Change Password Page</title>
    </h:head>
    <h:body>
        <c:if test="#{userController.passwordChanged and (userController.isIncorrectPassChange() eq 2)}">
            <h1>Unreal War!</h1><br></br>
            <h3>Password Changed</h3>
            <h:form>
                <h:commandButton value="Return to login page" class="btn btn-lg raised" style="font-size:24px" action="#{userController.clearFields()}"/>
            </h:form>
        </c:if>
        <c:if test="#{!userController.passwordChanged and (userController.isIncorrectPassChange() eq 1)}">
            <div class="container panel panel-default">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <img  id="logo" class="img-responsive center-block" src="img/logo.png" alt="CompanyLogo"></img>
                    </div>
                </div>
                <div class="row">
                    <div class=" col-md-6 col-md-offset-3 col-xs-6 col-xs-offset-3">
                        <div class="form-group">
                            <h:form style="inline">
                                <f:event listener="#{userController.validatePassword}" type="postValidate" /> 
                                <p>Sorry but the username or password you entered was incorrect</p><br></br>
                                <p>Username: 
                                    <h:inputText id="username" required="true" requiredMessage="Please enter a username" value="#{userController.instance.username}">
                                        <h:message for="username" style="color: red;" />
                                    </h:inputText>
                                </p>
                                <p>Old Password: 
                                    <h:inputSecret id="oldPassword"  required="true" requiredMessage="Please enter your old password" value="#{userController.instance.passhash}">
                                        <f:validateRequired />
                                        <h:message for="oldPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>                             
                                <f:event listener="#{userController.validatePassword}" type="postValidate" />  
                                <p>New Password: 
                                    <h:inputSecret id="newPassword"  required="true" requiredMessage="Please enter your new password" value="#{userController.newPassword}">
                                        <h:message for="newPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>
                                <p>Confirm new Password: 
                                    <h:inputSecret id="confirmPassword" required="true" requiredMessage="Please confirm your password" value="#{userController.confirmPassword}">
                                        <f:validateRequired />
                                        <h:message for="confirmPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>
                                <h:commandButton value="Change Password" class="btn btn-lg raised" style="font-size:24px" action="#{userController.editUserPassword(userController.instance.username, userController.instance.passhash, userController.newPassword, userController.confirmPassword)}" />
                                <div class="divider" />
                                <h:button value="Return to login page" class="btn btn-lg raised" style="font-size:24px" outcome="loginPage"/>                         
                            </h:form>
                        </div>
                    </div>
                </div>
                <footer  class="text-center">
                    <div class="panel-footer row">
                        <div class="col-xs-12">
                            <p class="footer"> Copyright © Unreal War. All rights reserved.</p>
                        </div>
                    </div>
                    <script src="js/jquery-3.2.0.min.js" type="text/javascript"></script>
                    <script src="js/bootstrap.min.js"></script>
                </footer>
            </div>
        </c:if>
        <c:if test="#{!userController.passwordChanged and (userController.isIncorrectPassChange() eq 0)}">
            <div class="container panel panel-default">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <img  id="logo" class="img-responsive center-block" src="img/logo.png" alt="CompanyLogo"></img>
                    </div>
                </div>
                <div class="row">
                    <div class=" col-md-6 col-md-offset-3 col-xs-6 col-xs-offset-3">
                        <div class="form-group">
                            <h:form style="inline">
                                <f:event listener="#{userController.validatePassword}" type="postValidate" />   
                                <p>Username: 
                                    <h:inputText id="username" required="true" requiredMessage="Please enter a username" value="#{userController.instance.username}">
                                        <h:message for="username" style="color: red;" />
                                    </h:inputText>
                                </p>
                                <p>Old Password: 
                                    <h:inputSecret id="oldPassword"  required="true" requiredMessage="Please enter your old password" value="#{userController.instance.passhash}">
                                        <f:validateRequired />
                                        <h:message for="oldPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>                             
                                <f:event listener="#{userController.validatePassword}" type="postValidate" />  
                                <p>New Password: 
                                    <h:inputSecret id="newPassword"  required="true" requiredMessage="Please enter your new password" value="#{userController.newPassword}">
                                        <h:message for="newPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>
                                <p>Confirm new Password: 
                                    <h:inputSecret id="confirmPassword" required="true" requiredMessage="Please confirm your password" value="#{userController.confirmPassword}">
                                        <f:validateRequired />
                                        <h:message for="confirmPassword" style="color:red" />
                                    </h:inputSecret>
                                </p>
                                <h:commandButton value="Change Password" class="btn btn-lg raised" style="font-size:24px" action="#{userController.editUserPassword(userController.instance.username, userController.instance.passhash, userController.newPassword, userController.confirmPassword)}" />
                                <div class="divider" />
                                <h:button value="Return to login page" class="btn btn-lg raised" style="font-size:24px" outcome="loginPage"/>                         
                            </h:form>
                        </div>
                    </div>
                </div>
                <footer  class="text-center">
                    <div class="panel-footer row">
                        <div class="col-xs-12">
                            <p class="footer"> Copyright © Unreal War. All rights reserved.</p>
                        </div>
                    </div>
                    <script src="js/jquery-3.2.0.min.js" type="text/javascript"></script>
                    <script src="js/bootstrap.min.js"></script>
                </footer>
            </div>
        </c:if>
    </h:body>
</html>

